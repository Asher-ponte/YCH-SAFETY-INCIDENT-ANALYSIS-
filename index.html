<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Incident Analysis and Comparison Charts (2024 vs 2025)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f4f7f6;
            color: #333;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 20px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            min-height: 300px;
            margin-bottom: 10px;
        }
        .interpretation {
            margin-top: 5px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: #eef2f7;
            border-left: 4px solid #0056b3;
            border-radius: 4px;
        }
        .interpretation h2 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #0056b3;
            font-size: 1.2em;
            text-align: left;
        }
        .interpretation p {
            font-size: 0.95em;
            line-height: 1.5;
            color: #555;
        }
    </style>
</head>
<body>
<!-- Header with logo and title -->
        <img src="YCH logo CMYK crop.png" alt="Company Logo" class="h-40 w-70">
        
    </div>
</header>

<!-- Navigation Cards -->
<div class="flex gap-4 mb-6 max-w-6xl w-full">
    <a href="2024.html" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-900 p-6 rounded-xl shadow-md text-center font-semibold text-lg transition">
        Safety Incident Analysis for 2024
    </a>
    <a href="2025.html" class="flex-1 bg-green-100 hover:bg-green-200 text-green-900 p-6 rounded-xl shadow-md text-center font-semibold text-lg transition">
        Safety Incident Analysis for 2025
    </a>
</div>
<body>
    <div class="container">
        <h1>Safety Incident Analysis and Comparison Charts (2024 vs 2025)</h1>
        <p class="text-center text-gray-600 mb-8">Comparing incident data from Jan-Oct 2024 and Jan-Apr 2025</p>

        <div class="chart-container">
            <canvas id="incidentsByDepartmentComparisonChart"></canvas>
        </div>
        <div class="interpretation">
            <h2>Interpretation: Incidents by Department Comparison</h2>
            <p>This bar chart compares the number of incidents per department group between the Jan-Oct 2024 period and the Jan-Apr 2025 period. Observations: CMP/Can Plant has the highest number of incidents in both years, though there's a drop from 10 in 2024 to 5 in 2025 (Jan–Apr). DC Inbound and Outbound remain high-risk zones with consistently reported incidents. VAS Warehouse and MPP Warehouse had low incident rates in 2024 and 2025, indicating better control in safety performance. Interpretation: The CMP/Can Plant consistently shows high incident frequency, indicating high risks in operations. DC areas have persistent safety concerns in both inbound and outbound.</p>
        </div>

        <div class="chart-container">
            <canvas id="incidentsByMonthComparisonChart"></canvas>
        </div>
        <div class="interpretation">
            <h2>Interpretation: Incidents by Month Comparison</h2>
            <p>This line chart shows the monthly trend of reported incidents for both 2024 (Jan-Oct) and 2025 (Jan-April). Observations: Peak incidents in March and April for both years. Despite fewer months in 2025, the early-year trends mirror 2024’s escalation curve. Interpretation: The repeat spike in Q1–Q2 suggests seasonal hazards due to post-holiday operational that reflects all there is non-compliance to the forklift safety, especially in lifting procedures. ✅ Corrective Actions: Increase BBS Inspection checking in these months and enhance safety awareness during the post-holiday season.</p>
        </div>

        <div class="chart-container">
            <canvas id="incidentsByTimeComparisonChart"></canvas>
        </div>
        <div class="interpretation">
            <h2>Interpretation: Incidents by Time of Day Comparison</h2>
            <p>This line chart compares the distribution of incidents throughout the 24 hours of the day for both 2024 (Jan-Oct) and 2025 (Jan-Apr). Separate lines represent the overall hourly trend for each year and also broken down by department. Observations: Higher incident rates during shift transitions and late afternoons from 6:00-9:00 and 17:00-23:00. Interpretation: Fatigue and decreased supervision may drive late-hour and early morning incidents. Transition periods often come with communication lapses and rushed tasks. ✅ Corrective Actions: Introduce safety reminder briefings during critical hours (6:00-9:00 and 17:00-23:00). Conduct surprise audits or observations during critical hours (e.g., 17:00–20:00).</p>
        </div>

        <div class="chart-container">
            <canvas id="incidentsByPersonComparisonChart"></canvas>
        </div>
        <div class="interpretation">
            <h2>Interpretation: Incidents by Person Comparison</h2>
            <p>This bar chart compares the total number of incidents associated with specific individuals across the Jan-Oct 2024 and Jan-Apr 2025 periods. It highlights individuals frequently involved in incidents, which can help identify training needs or areas requiring closer supervision. Note that involvement in an incident does not necessarily imply fault, and the 2024 data covers a longer timeframe. A detailed breakdown of incidents per person by month and department is available in the underlying data.</p>
        </div>

        <div class="chart-container">
            <canvas id="rootCauseComparisonChart"></canvas>
        </div>
        <div class="interpretation">
            <h2>Interpretation: Root Cause Frequency Comparison</h2>
            <p>This bar chart compares the frequency of the major root cause categories identified in the incidents for both the 2024 (Jan-Oct) and 2025 (Jan-Apr) periods. Root Cause Frequencies (Top 3): Unsafe Operation & Influencing Personal Factors, Environmental Conditions, Procedural/Systemic Issues. Interpretation: Unsafe behavior remains the top root cause, indicating that policies may exist but implementation and reinforcement are weak. ✅ Corrective Actions: Launch a Behavior-Based Safety (BBS) program with coaching and peer observations. Review and update SOPs—ensure accessibility and comprehension of all FLO. Improve physical environment: lighting, signage, walkway markings.</p>
        </div>
    </div>

    <script>
        // Data based on the comparison analysis
        const incidents2024 = [
            { date: 'Jan 08, 2024', time: '17:30', department: 'MPP Warehouse', involved_person: 'Jhonder Plata', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Environmental Conditions'] },
            { date: 'Jan 10, 2024', time: '08:15', department: 'VAS Warehouse', involved_person: 'Rhealyn Biscocha', root_cause: ['Equipment Condition'] },
            { date: 'Jan 22, 2024', time: '23:00', department: 'CMP Warehouse', involved_person: 'Bernabe Hermones', root_cause: ['Equipment Condition', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Jan 17, 2024', time: '11:40', department: 'CMP Warehouse', involved_person: 'Bernabe Hermones', root_cause: ['Environmental Conditions', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Feb 22, 2024', time: '18:20', department: 'DC Inbound', involved_person: 'Edmond Cardinas(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Mar 01, 2024', time: '19:00', department: 'MPP Warehouse', involved_person: 'Celso Navarro', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Mar 05, 2024', time: '12:20', department: 'CMP Warehouse', involved_person: 'Omar Florendo(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Mar 09, 2024', time: '17:30', department: 'MPP Warehouse', involved_person: 'Mark Cabilangan', root_cause: ['Material Condition', 'Environmental Conditions'] },
            { date: 'Mar 23, 2024', time: '02:50', department: 'MPP Warehouse', involved_person: 'Mark Cabilangan', root_cause: ['Equipment Condition', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Apr 18, 2024', time: '08:30', department: 'DC Inbound', involved_person: 'Edmond Cardinas(EX AMC)', root_cause: ['Equipment Condition', 'Procedural/Systemic Issues'] },
            { date: 'Apr 19, 2024', time: '19:39', department: 'DC Inbound', involved_person: 'Ronel Balneg', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Environmental Conditions'] },
            { date: 'Apr 22, 2024', time: '15:17', department: 'DC Outbound', involved_person: 'Kevin Baylon', root_cause: ['Environmental Conditions', 'Procedural/Systemic Issues', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Apr 19, 2024', time: '18:45', department: 'DC Outbound', involved_person: 'Exodus Martires', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Procedural/Systemic Issues'] },
            { date: 'Apr 21, 2024', time: '06:00', department: 'DC Inbound', involved_person: 'Nathaniel Cea (EX AMC)', root_cause: ['Procedural/Systemic Issues'] },
            { date: 'Jun 20, 2024', time: '07:51', department: 'DC Outbound', involved_person: 'Jose Barrameda(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Jun 18, 2024', time: '06:30', department: 'CMP Warehouse', involved_person: 'Teddy Almendral', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Jun 26, 2024', time: '11:19', department: 'DC Warehouse', involved_person: 'Leo Mendoza (EX AMC)', root_cause: ['Environmental Conditions', 'Procedural/Systemic Issues'] },
            { date: 'Jun 27, 2024', time: '20:40', department: 'DC Warehouse', involved_person: 'Roberto Dela Cruz (EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Procedural/Systemic Issues'] },
            { date: 'Aug 07, 2024', time: '07:00', department: 'Outbound', involved_person: 'Leo Mendoza', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Procedural/Systemic Issues'] },
            { date: 'Aug 30, 2024', time: '08:45', department: 'DC', involved_person: 'Julius Alilita', root_cause: ['Environmental Conditions', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Sep 09, 2024', time: '23:30', department: 'CMP Warehouse', involved_person: 'Christopher Malinao(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Environmental Conditions'] },
            { date: 'Sep 21, 2024', time: '08:20', department: 'DC Inbound', involved_person: 'Walter Bartolome', root_cause: ['Environmental Conditions', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Sep 21, 2024', time: '17:20', department: 'CMP Warehouse', involved_person: 'Christopher Malinao(EX AMC)', root_cause: ['Environmental Conditions', 'Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Sep 30, 2024', time: '17:09', department: 'CMP Warehouse', involved_person: 'Christopher Malinao(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Environmental Conditions'] },
            { date: 'Oct 03, 2024', time: '06:20', department: 'CMP Warehouse', involved_person: 'Jhonder Plata', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Procedural/Systemic Issues'] },
            { date: 'Oct 03, 2024', time: '23:40', department: 'DC Warehouse', involved_person: 'Rodel Vega', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Oct 06, 2024', time: '11:30', department: 'DC Warehouse', involved_person: 'Roberto Dela Cruz(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors', 'Procedural/Systemic Issues'] },
        ];

        const incidents2025 = [
            { date: 'Jan 05, 2025', time: '01:30', department: 'MPP Warehouse', involved_person: 'Mark Cabilangan', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Jan 06, 2025', time: '22:00', department: 'DC INBOUND', involved_person: 'Edmond Cardinas(EX AMC)', root_cause: ['Environmental Conditions'] },
            { date: 'Jan 10, 2025', time: '08:00', department: 'CMP Warehouse', involved_person: 'Edwin Nacional', root_cause: ['Procedural/Systemic Issues'] },
            { date: 'Jan 15, 2025', time: '18:00', department: 'DC OUTBOUND', involved_person: 'Roberto Dela Cruz(EX AMC)', root_cause: ['Equipment Condition'] },
            { date: 'Feb 01, 2025', time: '01:00', department: 'MPP Warehouse', involved_person: 'Alexander Leron(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Feb 10, 2025', time: '08:00', department: 'DC INBOUND', involved_person: 'Noel Solsona', root_cause: ['Environmental Conditions'] },
            { date: 'Feb 15, 2025', time: '19:00', department: 'CMP Warehouse', involved_person: 'Teddy Almendral', root_cause: ['Procedural/Systemic Issues'] },
            { date: 'Mar 01, 2025', time: '00:30', department: 'MPP Warehouse', involved_person: 'Bernabe Hermones', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
            { date: 'Mar 10, 2025', time: '09:00', department: 'DC OUTBOUND', involved_person: 'Miguel Sedaria', root_cause: ['Equipment Condition'] },
            { date: 'Mar 15, 2025', time: '23:00', department: 'DC INBOUND', involved_person: 'Virgilio Mersonia', root_cause: ['Environmental Conditions'] },
            { date: 'Apr 01, 2025', time: '15:00', department: 'CMP Warehouse', involved_person: 'Zoilo Copo(EX AMC)', root_cause: ['Procedural/Systemic Issues'] },
            { date: 'Apr 10, 2025', time: '18:00', department: 'MPP Warehouse', involved_person: 'Dante Dayao(EX AMC)', root_cause: ['Unsafe Operation & Influencing Personal Factors'] },
        ];

        // Helper function to process department names for aggregation
        function getAggregatedDepartment(department) {
            if (!department) return 'Unknown';
            const upperDept = department.toUpperCase();
            if (upperDept.includes('CMP') || upperDept.includes('CAN PLANT')) return 'CMP/Can Plant';
            if (upperDept.includes('DC INBOUND') || upperDept.includes('INBOUND')) return 'DC Inbound';
            if (upperDept.includes('DC OUTBOUND') || upperDept.includes('OUTBOUD')) return 'DC Outbound';
            if (upperDept.includes('MPP')) return 'MPP Warehouse';
            if (upperDept.includes('VAS')) return 'VAS Warehouse';
            if (upperDept.includes('DC')) return 'DC Warehouse';
            return department;
        }

        // Process data for charts
        const incidentsByDepartment2024 = {
            'CMP/Can Plant': 10,
            'DC Inbound': 6,
            'DC Outbound': 7,
            'MPP Warehouse': 4,
            'VAS Warehouse': 1
        };

        const incidentsByDepartment2025 = {
            'CMP/Can Plant': 5,
            'DC Inbound': 3,
            'DC Outbound': 3,
            'MPP Warehouse': 1,
            'VAS Warehouse': 0,
            
        };

        const incidentsByMonth2024 = incidents2024.reduce((acc, incident) => {
            try {
                const date = new Date(incident.date);
                const month = date.toLocaleString('en-US', { month: 'long' });
                if (month && month !== 'Invalid Date') {
                    acc[month] = (acc[month] || 0) + 1;
                } else {
                    console.warn("Invalid date for incident:", incident);
                }
            } catch (e) {
                console.error("Error processing date for incident:", incident, e);
            }
            return acc;
        }, {});

        const incidentsByMonth2025 = incidents2025.reduce((acc, incident) => {
            try {
                const date = new Date(incident.date);
                const month = date.toLocaleString('en-US', { month: 'long' });
                if (month && month !== 'Invalid Date') {
                    acc[month] = (acc[month] || 0) + 1;
                } else {
                    console.warn("Invalid date for incident:", incident);
                }
            } catch (e) {
                console.error("Error processing date for incident:", incident, e);
            }
            return acc;
        }, {});

        const hourLabels = Array.from({ length: 24 }, (_, i) => `${i}:00`);
        const departmentGroups = ['CMP/Can Plant', 'DC Inbound', 'DC Outbound', 'MPP Warehouse', 'VAS Warehouse', 'DC Warehouse', 'Unknown'];
        const incidentsByHour2024 = {};
        const incidentsByHour2025 = {};

        departmentGroups.forEach(group => {
            incidentsByHour2024[group] = Array(24).fill(0);
            incidentsByHour2025[group] = Array(24).fill(0);
        });

        incidents2024.forEach(incident => {
            if (incident.time) {
                try {
                    const [hours] = incident.time.split(':').map(Number);
                    if (!isNaN(hours) && hours >= 0 && hours < 24) {
                        const departmentGroup = getAggregatedDepartment(incident.department);
                        if (incidentsByHour2024[departmentGroup]) {
                            incidentsByHour2024[departmentGroup][hours]++;
                        } else {
                            incidentsByHour2024[departmentGroup] = Array(24).fill(0);
                            incidentsByHour2024[departmentGroup][hours]++;
                            if (!departmentGroups.includes(departmentGroup)) {
                                departmentGroups.push(departmentGroup);
                            }
                        }
                    } else {
                        console.warn("Invalid time format or hour value for 2024 incident:", incident);
                    }
                } catch (e) {
                    console.error("Error parsing time for 2024 incident:", incident, e);
                }
            }
        });

        incidents2025.forEach(incident => {
            if (incident.time) {
                try {
                    const [hours] = incident.time.split(':').map(Number);
                    if (!isNaN(hours) && hours >= 0 && hours < 24) {
                        const departmentGroup = getAggregatedDepartment(incident.department);
                        if (incidentsByHour2025[departmentGroup]) {
                            incidentsByHour2025[departmentGroup][hours]++;
                        } else {
                            incidentsByHour2025[departmentGroup] = Array(24).fill(0);
                            incidentsByHour2025[departmentGroup][hours]++;
                            if (!departmentGroups.includes(departmentGroup)) {
                                departmentGroups.push(departmentGroup);
                            }
                        }
                    } else {
                        console.warn("Invalid time format or hour value for 2025 incident:", incident);
                    }
                } catch (e) {
                    console.error("Error parsing time for 2025 incident:", incident, e);
                }
            }
        });

        const incidentsByPerson2024 = incidents2024.reduce((acc, incident) => {
            if (incident.involved_person) {
                acc[incident.involved_person] = (acc[incident.involved_person] || 0) + 1;
            }
            return acc;
        }, {});

        const incidentsByPerson2025 = incidents2025.reduce((acc, incident) => {
            if (incident.involved_person) {
                acc[incident.involved_person] = (acc[incident.involved_person] || 0) + 1;
            }
            return acc;
        }, {});

        const rootCauseFrequency2024 = {
            'Unsafe Operation & Influencing Personal Factors': 22,
            'Environmental Conditions': 11,
            'Procedural/Systemic Issues': 9,
            'Equipment Condition': 4,
            'Material Condition': 1
        };

        const rootCauseFrequency2025 = {
            'Unsafe Operation & Influencing Personal Factors': 16,
            'Environmental Conditions': 14,
            'Procedural/Systemic Issues': 13,
            'Equipment Condition': 12,
            'Material Condition': 5
        };

        document.addEventListener('DOMContentLoaded', () => {
            const departmentLabels = Object.keys({...incidentsByDepartment2024, ...incidentsByDepartment2025});
            const departmentData2024 = departmentLabels.map(label => incidentsByDepartment2024[label] || 0);
            const departmentData2025 = departmentLabels.map(label => incidentsByDepartment2025[label] || 0);

            const monthLabels = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'];
            const monthData2024Chart = monthLabels.map(month => incidentsByMonth2024[month] || 0);
            const monthData2025Chart = monthLabels.map(month => {
                if (['January', 'February', 'March', 'April'].includes(month)) {
                    return incidentsByMonth2025[month] || 0;
                }
                return null;
            });

            const hourLabels = Array.from({ length: 24 }, (_, i) => `${i}:00`);
            const timeComparisonDatasets = [];
            const incidentsByHour_All_2024 = Array(24).fill(0);
            incidents2024.forEach(incident => {
                if (incident.time) {
                    try {
                        const [hours] = incident.time.split(':').map(Number);
                        if (!isNaN(hours) && hours >= 0 && hours < 24) {
                            incidentsByHour_All_2024[hours]++;
                        }
                    } catch (e) {
                        console.error("Error parsing time for 2024 incident:", incident, e);
                    }
                }
            });

            const incidentsByHour_All_2025 = Array(24).fill(0);
            incidents2025.forEach(incident => {
                if (incident.time) {
                    try {
                        const [hours] = incident.time.split(':').map(Number);
                        if (!isNaN(hours) && hours >= 0 && hours < 24) {
                            incidentsByHour_All_2025[hours]++;
                        }
                    } catch (e) {
                        console.error("Error parsing time for 2025 incident:", incident, e);
                    }
                }
            });

            timeComparisonDatasets.push({
                label: 'Overall (2024)',
                data: incidentsByHour_All_2024,
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: false,
                tension: 0.1,
                hidden: false
            });

            timeComparisonDatasets.push({
                label: 'Overall (2025)',
                data: incidentsByHour_All_2025,
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                fill: false,
                tension: 0.1,
                hidden: false
            });

            departmentGroups.forEach(group => {
                if (incidentsByHour2024[group] && incidentsByHour2024[group].some(count => count > 0)) {
                    timeComparisonDatasets.push({
                        label: `${group} (2024)`,
                        data: incidentsByHour2024[group],
                        borderColor: `rgba(${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, 1)`,
                        backgroundColor: `rgba(${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, ${Math.floor(Math.random() * 200)}, 0.2)`,
                        fill: false,
                        tension: 0.1,
                        hidden: false
                    });
                }
            });

            departmentGroups.forEach(group => {
                if (incidentsByHour2025[group] && incidentsByHour2025[group].some(count => count > 0)) {
                    timeComparisonDatasets.push({
                        label: `${group} (2025)`,
                        data: incidentsByHour2025[group],
                        borderColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`,
                        backgroundColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.2)`,
                        fill: false,
                        tension: 0.1,
                        hidden: false
                    });
                }
            });

            // Sort incidents by person from highest to lowest total incidents
            const incidentsByPerson2024 = incidents2024.reduce((acc, incident) => {
                if (incident.involved_person) {
                    acc[incident.involved_person] = (acc[incident.involved_person] || 0) + 1;
                }
                return acc;
            }, {});

            const incidentsByPerson2025 = incidents2025.reduce((acc, incident) => {
                if (incident.involved_person) {
                    acc[incident.involved_person] = (acc[incident.involved_person] || 0) + 1;
                }
                return acc;
            }, {});

            const allPersons = Object.keys({...incidentsByPerson2024, ...incidentsByPerson2025});
            const personData2024 = allPersons.map(person => incidentsByPerson2024[person] || 0);
            const personData2025 = allPersons.map(person => incidentsByPerson2025[person] || 0);

            // Calculate total incidents per person and sort
            const personTotals = allPersons.map(person => ({
                name: person,
                total: (incidentsByPerson2024[person] || 0) + (incidentsByPerson2025[person] || 0)
            })).sort((a, b) => b.total - a.total);

            const sortedPersons = personTotals.map(item => item.name);
            const sortedPersonData2024 = sortedPersons.map(person => incidentsByPerson2024[person] || 0);
            const sortedPersonData2025 = sortedPersons.map(person => incidentsByPerson2025[person] || 0);

            const rootCauseLabels = Object.keys({...rootCauseFrequency2024, ...rootCauseFrequency2025});
            const rootCauseData2024 = rootCauseLabels.map(label => rootCauseFrequency2024[label] || 0);
            const rootCauseData2025 = rootCauseLabels.map(label => rootCauseFrequency2025[label] || 0);

            console.log("Sorted Persons:", sortedPersons);
            console.log("Sorted Person Data 2024:", sortedPersonData2024);
            console.log("Sorted Person Data 2025:", sortedPersonData2025);

            const departmentComparisonCtx = document.getElementById('incidentsByDepartmentComparisonChart').getContext('2d');
            if (departmentComparisonCtx) {
                new Chart(departmentComparisonCtx, {
                    type: 'bar',
                    data: {
                        labels: departmentLabels,
                        datasets: [
                            {
                                label: '2024 (Jan-Oct)',
                                data: departmentData2024,
                                backgroundColor: 'rgba(0, 123, 255, 0.7)',
                                borderColor: 'rgba(0, 123, 255, 1)',
                                borderWidth: 1
                            },
                            {
                                label: '2025 (Jan-Apr)',
                                data: departmentData2025,
                                backgroundColor: 'rgba(40, 167, 69, 0.7)',
                                borderColor: 'rgba(40, 167, 69, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Incidents by Department Comparison (2024 vs 2025)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Incidents'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Department'
                                }
                            }
                        }
                    }
                });
            } else {
                console.error("Could not get context for department comparison chart.");
            }

            const monthComparisonCtx = document.getElementById('incidentsByMonthComparisonChart').getContext('2d');
            if (monthComparisonCtx) {
                new Chart(monthComparisonCtx, {
                    type: 'line',
                    data: {
                        labels: monthLabels,
                        datasets: [
                            {
                                label: '2024',
                                data: monthData2024Chart,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                fill: false,
                                tension: 0.1
                            },
                            {
                                label: '2025',
                                data: monthData2025Chart,
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                fill: false,
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Incidents by Month Comparison (2024 vs 2025)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Incidents'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Month'
                                }
                            }
                        }
                    }
                });
            } else {
                console.error("Could not get context for month comparison chart.");
            }

            const timeComparisonCtx = document.getElementById('incidentsByTimeComparisonChart').getContext('2d');
            if (timeComparisonCtx) {
                new Chart(timeComparisonCtx, {
                    type: 'line',
                    data: {
                        labels: hourLabels,
                        datasets: timeComparisonDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Incidents by Time of Day Comparison (2024 vs 2025)'
                            },
                            legend: {
                                display: true
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Incidents'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time of Day (Hour)'
                                }
                            }
                        }
                    }
                });
            } else {
                console.error("Could not get context for time comparison chart.");
            }

            const personComparisonCtx = document.getElementById('incidentsByPersonComparisonChart').getContext('2d');
            if (personComparisonCtx) {
                new Chart(personComparisonCtx, {
                    type: 'bar',
                    data: {
                        labels: sortedPersons,
                        datasets: [
                            {
                                label: '2024 (Jan-Oct)',
                                data: sortedPersonData2024,
                                backgroundColor: 'rgba(255, 206, 86, 0.7)',
                                borderColor: 'rgba(255, 206, 86, 1)',
                                borderWidth: 1
                            },
                            {
                                label: '2025 (Jan-Apr)',
                                data: sortedPersonData2025,
                                backgroundColor: 'rgba(159, 100, 255, 0.7)',
                                borderColor: 'rgba(159, 100, 255, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Incidents by Person Comparison (2024 vs 2025)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Incidents'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Person Involved'
                                }
                            }
                        }
                    }
                });
            } else {
                console.error("Could not get context for person comparison chart.");
            }

            const rootCauseComparisonCtx = document.getElementById('rootCauseComparisonChart').getContext('2d');
            if (rootCauseComparisonCtx) {
                new Chart(rootCauseComparisonCtx, {
                    type: 'bar',
                    data: {
                        labels: rootCauseLabels,
                        datasets: [
                            {
                                label: '2024 (Jan-Oct)',
                                data: rootCauseData2024,
                                backgroundColor: 'rgba(255, 159, 64, 0.7)',
                                borderColor: 'rgba(255, 159, 64, 1)',
                                borderWidth: 1
                            },
                            {
                                label: '2025 (Jan-Apr)',
                                data: rootCauseData2025,
                                backgroundColor: 'rgba(153, 102, 255, 0.7)',
                                borderColor: 'rgba(153, 102, 255, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Root Cause Frequency Comparison (2024 vs 2025)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Frequency'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Root Cause Category'
                                }
                            }
                        }
                    }
                });
            } else {
                console.error("Could not get context for root cause comparison chart.");
            }
        });
    </script>
</body>
</html>
